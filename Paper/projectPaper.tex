\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{amsmath}
\usepackage{derivative}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{float}
\usetikzlibrary{arrows,decorations.pathmorphing,backgrounds,positioning,fit,matrix}
\usepackage[symbols,nogroupskip,record]{glossaries-extra}
\usepackage[
backend=biber,
style=alphabetic,
sorting=ynt
]{biblatex}
\addbibresource{references.bib}

\glsxtrnewsymbol[
 description={position},
 location={[see ch.~\ref{ch1}].}
]{x}{\ensuremath{x}}
\glsxtrnewsymbol[description={velocity}]{v}{\ensuremath{v}}
\glsxtrnewsymbol[description={acceleration}]{a}{\ensuremath{a}}
\glsxtrnewsymbol[description={time}]{t}{\ensuremath{t}}
\glsxtrnewsymbol[description={gap}]{s}{\ensuremath{s}}
\glsxtrnewsymbol[description={desired speed (typically $33$ m/s)},
location = {[see ch.~\ref{ch3.1}]}]{v0}{\ensuremath{v_0}}
\glsxtrnewsymbol[description={adaptation time (typically $0.65$ s)}]{ta}{\ensuremath{\tau}}
\glsxtrnewsymbol[description={speed difference sensitivity}]{ga}{\ensuremath{\gamma}}

\title{Investigating Car Following Model}
\author{Kaeshav Danesh and Kevin Phan}
\date{\today}

\begin{document}
    \maketitle

    \begin{abstract}
        Traffic flow dynamics is generally split into either macroscopic models or microscopic models. For this paper, we will focus on car following models which is a type of microscopic model. We first introduce the assumptions and the mathematical description car following model and the numerical scheme used to compute them. Then, we give the full velocity difference model. Finally, we examine different scenarios such as car crashes, phantom traffic, traffic light, and lane changes and analyze the behavior of cars. 
    \end{abstract}

    \newpage

    \tableofcontents

    \newpage

    \section{Introduction}
    
    Some questions to answer:
    \begin{itemize}
        \item Why are traffic models important? Applications?
        \item At what scale does our model operate at? Macroscopic and microscopic?  
        \item What assumptions are we making? 
    \end{itemize}

    \section{General Model}
    \subsection{Mathematical Formulation}\label{ch1}
        We follow the mathematical formulation of car following model in \cite{traffic}. Suppose that there are $n$ cars in the car following model. We index the $1$st car by $1$, the $2$nd car by $2$, the $\alpha$th car by $\alpha$, and so on. The state variables of car $\alpha$ are position $x_\alpha$, velocity $v_\alpha$, and acceleration $a_\alpha$. Furthermore, we are also assuming that the cars in the model has some kind of width. Thus, the position $x_\alpha$ of car $\alpha$ is defined as the front bumper of the car. Another useful variable to define is gap. We define the gap of car $\alpha$ by the difference in distance between the back bumper of car $\alpha - 1$ and the front bumper of car $\alpha$. Mathematically, the gap $s_\alpha$ is defined as 
        \begin{equation} 
          s_\alpha = x_{\alpha - 1} - l_{\alpha -1}  - x_{\alpha}
        \end{equation}
        where $x_{\alpha - 1}$ is the position of car $\alpha - 1$, $l_{\alpha - 1}$ is the length of car $\alpha - 1$, and $x_\alpha$ is the position of car $\alpha$. We note that the gap is not defined for a car with no cars in front of it. 
        \begin{figure}[H]
            \begin{tikzpicture}[scale=1.55]
                \draw (-0.3,-0.3) -- (7.3,-0.3);
                \draw [fill = blue] (0,0) rectangle (2,0.7);
                \draw [fill=gray, thick] (0.5,0) circle [radius=0.3];
                \draw [fill=gray, thick] (1.5,0) circle [radius=0.3];
                \draw (1.5,0.7) -- (1.1,1.1);
                \draw (1.1,1.1) -- (0.6,1.1);
                \draw (0.6,1.1) -- (0.4,0.7);
                \node (car_a-1) at (0.85,1.3) {Car $\alpha$};
                \node (vel) at (2.3,0.9) {$v_{\alpha}$};
                \node (vel_start) at (1.3,0.9) {};
                \draw[->] (vel_start) -> (vel);
                \begin{scope}[shift={(5,0)}]
                    \draw [fill = red] (0,0) rectangle (2,0.7);
                    \draw [fill=gray, thick] (0.5,0) circle [radius=0.3];
                    \draw [fill=gray, thick] (1.5,0) circle [radius=0.3];
                    \draw (1.5,0.7) -- (1.1,1.1);
                    \draw (1.1,1.1) -- (0.6,1.1);
                    \draw (0.6,1.1) -- (0.4,0.7);
                    \node (car_a-1) at (0.85,1.3) {Car $\alpha - 1$};
                    \node (vel) at (2.3,0.9) {$v_{\alpha - 1}$};
                    \node (vel_start) at (1.3,0.9) {};
                    \draw[->] (vel_start) -> (vel);
                  \end{scope}
                \node (x) at (2,0.35) {};
                \node (y) at (5,0.35) {};
                \node (x_pos) at (2,0) {};
                \node (x_sym) at (2,-0.7) {$x_{\alpha }$};
                \node (x_pos1) at (7,0) {};
                \node (x_sym1) at (7,-0.7) {$x_{\alpha - 1}$};
                \draw[<->] (x) -- node[above] {$s_{\alpha}$} (y);
                \draw[<-] (x_pos) -- (x_sym);
                \draw[<-] (x_pos1) -- (x_sym1);
                \end{tikzpicture} 
            \centering
            \caption{Defining index, position, velocity, and gap of a car.}
        \end{figure}  
        For simpler notation, we will now refer to the car in front of car $\alpha$ by the leader car $l$. For a single lane, car $l$ is car $\alpha - 1$. However, it is not necessarily true that car $l$ is car $\alpha - 1$ for multiple lanes. 

        Taking the time derivatives of $x_\alpha (t)$ and $v_\alpha (t)$ lead to the general coupled differential equation describing velocity and acceleration respectively: 
        \begin{align} 
          \odv{x_\alpha(t)}{t} &= v_\alpha (t), \\
          \odv{v_\alpha (t)}{t} &= a_\alpha (s_\alpha, v_\alpha, v_l).
        \end{align}
        Car following models choose a specific acceleration function. For the simulation, we will use the Full Velocity Difference Model (FVDM) which is described in section (\ref{ch3.1}).
    \subsection{Numerical Scheme}
    TODO: Why RK4 versus mixed first order and second order numerical scheme, order we are doing the iterated numerical scheme (doing it from the last car to the first car)
    \cite{numerics}
    \section{Car Following Model}
    \subsection{Full Velocity Difference Model}\label{ch3.1}
    \section{Examining Different Scenarios}
    \subsection{Homogeneous Traffic}
    TODO: Give basic graphs so that we can compare to in the next sections and add any pitfalls with the model (unrealistic acceleration)
    \subsubsection{Simulation}
    \subsubsection{Pitfalls}
    \subsection{Bottleneck}
    TODO: Add time versus position graph and label the different situations, density graph, analysis 
    \subsubsection{Implementation}
    \subsubsection{Simulation}
    \subsubsection{Analysis}
    \subsection{Phantom Traffic: Local Perturbation}
    \subsubsection{Implementation}
    TODO: Look at how stopping suddenly propagate through the cars. Something about waves? 
    \subsection{Lane Changes}
    TODO: Average lane speed (How much faster is one lane with and without lane changes) and bottleneck revisted (make it from 2 lanes to one lane) and how number of lanes affect flow rate. The grass is greener on the other side paradox (in the textbook) 
    \subsubsection{Implementation}
    \subsubsection{Simulation}
    \subsubsection{Analysis}
    \section{Conclusion}
    \section{Further Remarks}
    \printunsrtglossary[type=symbols,style=long,title={List of Symbols and Constants}]
    \newpage 
    \printbibliography
\end{document}