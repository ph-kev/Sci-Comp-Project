\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{amsmath}
\usepackage{derivative}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{float}
\usepackage{float}
\usetikzlibrary{arrows,decorations.pathmorphing,backgrounds,positioning,fit,matrix}
\usepackage[symbols,nogroupskip,record]{glossaries-extra}
\usepackage[
backend=biber,
style=alphabetic,
sorting=ynt
]{biblatex}
\addbibresource{references.bib}

\glsxtrnewsymbol[description={position},location={[see ch.~\ref{ch1}].}]{x}{\ensuremath{x}}
\glsxtrnewsymbol[description={velocity},location={[see ch.~\ref{ch1}].}]{v}{\ensuremath{v}}
\glsxtrnewsymbol[description={acceleration},location={[see ch.~\ref{ch1}].}]{a}{\ensuremath{a}}
\glsxtrnewsymbol[description={time},location={[see ch.~\ref{ch1}].}]{t}{\ensuremath{t}}
\glsxtrnewsymbol[description={gap},location={[see ch.~\ref{ch1}].}]{s}{\ensuremath{s}}
\glsxtrnewsymbol[description={desired speed (typically $33$ m/s)},
location = {[see ch.~\ref{ch3.1}]}]{v0}{\ensuremath{v_0}}
\glsxtrnewsymbol[description={adaptation time (typically $0.65$ s)}]{ta}{\ensuremath{\tau}}
\glsxtrnewsymbol[description={speed difference sensitivity}]{ga}{\ensuremath{\gamma}}

\title{Investigating Car Following Model}
\author{Kaeshav Danesh and Kevin Phan}
\date{\today}

\begin{document}
    \maketitle

    \begin{abstract}
        Traffic flow dynamics is generally split into either macroscopic models or microscopic models. For this paper, we will focus on car following models which is a type of microscopic model. We first introduce the assumptions and the mathematical description car following model and the numerical scheme used to compute them. Then, we give the full velocity difference model. Finally, we examine different scenarios such as bottlenecks, phantom traffic, and lane changes and analyze the behavior of cars. 
    \end{abstract}

    \newpage

    \tableofcontents

    \newpage

    \section{Introduction}
    How does a bottleneck affect a series of vehicles? How do a traffic jam propagate through a series of vehicles? What impact does changing a road from multiple lanes to one lane have a series of cars? To answer these questions, our paper will describe a basic microscopic car following model from traffic flow theory, implement these scenarios, and analyze them. 

    Traffic flow models can be categorized as microscopic or macroscopic models [\cite{hisTraffic}]. Microscopic models describe vehicles on the individual level by treating them as entire unit. Meanwhile, macroscopic models treat vehicles as a continuum. Further classifications can be done through the model equations such as partial differential equations, discrete equations, discrete or continuous variables, and deterministic or stochastic process. Some applications of traffic flow models include simulating traffic, optimizing traffic lights, and calculating carbon emissions from traffic. 

    Our paper will focus only on the microscopic model called the Full Velocity Difference model. Using this model, we will explore scenarios including bottlenecks, phantom traffic, and lane changes. From this, we will analyze state variables including position, velocity, and acceleration, and other metrics such as density and flow rate. 
    Some questions to answer:
    % \begin{itemize}
    %     \item Why are traffic models important? Applications?
    %     \item At what scale does our model operate at? Macroscopic and %     microscopic?  
    %     \item What assumptions are we making? 
    % \end{itemize}

    \section{General Model}
    \subsection{Mathematical Formulation}\label{ch1}
        We follow the mathematical formulation of car following model in \S 10.2 of \cite{traffic}. Suppose that there are $n$ vehicles in the simulation using the car following model. We index the $1$st vehicle by $1$, the $2$nd car by $2$, the $\alpha$th car by $\alpha$, and so on. The state variables of vehicle $\alpha$ are position $x_\alpha$, velocity $v_\alpha$, and acceleration $a_\alpha$. Furthermore, we are also assuming that the vehicles in the model has a length $l$. The position $x_\alpha$ of car $\alpha$ is defined as the front bumper of the car. Another useful variable to define is gap. We define the gap of car $\alpha$ by the difference in distance between the back bumper of car $\alpha - 1$ and the front bumper of car $\alpha$. Mathematically, the gap $s_\alpha$ is defined as 
        \begin{equation} 
          s_\alpha = x_{\alpha - 1} - l_{\alpha -1}  - x_{\alpha}
        \end{equation}
        where $x_{\alpha - 1}$ is the position of car $\alpha - 1$, $l_{\alpha - 1}$ is the length of car $\alpha - 1$, and $x_\alpha$ is the position of car $\alpha$. We note that the gap is not defined for a vehicle with no vehicles in front of it. 
        \begin{figure}[H]
            \begin{tikzpicture}[scale=1.55]
                \draw (-0.3,-0.3) -- (7.3,-0.3);
                \draw [fill = blue] (0,0) rectangle (2,0.7);
                \draw [fill=gray, thick] (0.5,0) circle [radius=0.3];
                \draw [fill=gray, thick] (1.5,0) circle [radius=0.3];
                \draw (1.5,0.7) -- (1.1,1.1);
                \draw (1.1,1.1) -- (0.6,1.1);
                \draw (0.6,1.1) -- (0.4,0.7);
                \node (car_a-1) at (0.85,1.3) {Car $\alpha$};
                \node (vel) at (2.3,0.9) {$v_{\alpha}$};
                \node (vel_start) at (1.3,0.9) {};
                \draw[->] (vel_start) -> (vel);
                \begin{scope}[shift={(5,0)}]
                    \draw [fill = red] (0,0) rectangle (2,0.7);
                    \draw [fill=gray, thick] (0.5,0) circle [radius=0.3];
                    \draw [fill=gray, thick] (1.5,0) circle [radius=0.3];
                    \draw (1.5,0.7) -- (1.1,1.1);
                    \draw (1.1,1.1) -- (0.6,1.1);
                    \draw (0.6,1.1) -- (0.4,0.7);
                    \node (car_a-1) at (0.85,1.3) {Car $\alpha - 1$};
                    \node (vel) at (2.3,0.9) {$v_{\alpha - 1}$};
                    \node (vel_start) at (1.3,0.9) {};
                    \draw[->] (vel_start) -> (vel);
                  \end{scope}
                \node (x) at (2,0.35) {};
                \node (y) at (5,0.35) {};
                \node (x_pos) at (2,0) {};
                \node (x_sym) at (2,-0.7) {$x_{\alpha }$};
                \node (x_pos1) at (7,0) {};
                \node (x_sym1) at (7,-0.7) {$x_{\alpha - 1}$};
                \draw[<->] (x) -- node[above] {$s_{\alpha}$} (y);
                \draw[<-] (x_pos) -- (x_sym);
                \draw[<-] (x_pos1) -- (x_sym1);
                \end{tikzpicture} 
            \centering
            \caption{Defining index, position, velocity, and gap of a car.}
        \end{figure}  
        For simpler notation, we will now refer to the vehicle in front of vehicle $\alpha$ by the leader vehicle $l$. For a single lane, car $l$ is vehicle $\alpha - 1$. However, it is not necessarily true that vehicle $l$ is vehicle $\alpha - 1$ for multiple lanes. 

        Taking the time derivatives of $x_\alpha (t)$ and $v_\alpha (t)$ lead to the general coupled differential equation describing velocity and acceleration respectively: 
        \begin{align} 
          \odv{x_\alpha(t)}{t} &= v_\alpha (t), \\
          \odv{v_\alpha (t)}{t} &= a_{\rm mic} (s_\alpha, v_\alpha, v_l).
        \end{align}
        Each car following model has a specific acceleration function: $a_{\rm mic}\footnote{We use $a_{\rm mic}$ for the acceleration function and $a$ to describe the state variable acceleration.}$. For the simulation, we will use the Full Velocity Difference Model (FVDM) which is described in section (\ref{ch3.1}).
    \subsection{Numerical Scheme}
    The standard way of numerically solving a system of coupled differential equations would be to use a fourth order Runge Kutta method.
    However, higher order methods all assume higher orders of smoothness in the differential equation and its solution [\cite{numerics}].
    Our model is only smooth to first order because suddenly changes in acceleration is common, for example, during lane changes. 
    So, using a high order method could be worse than a simple first order method.

    Among first order methods, our options are either the forward or backwards (implicit) Euler methods. The main difference between these methods is that the backwards Euler method involves solving an implicit equation and is generally more stable.

    We are using the forward Euler method because we expect our solution to be stable and solving an implicit equation every timestep would add extra complexity to our implementation.

    Implementing the forwards Euler method scheme for a car following model gives us two coupled differential equations for each of our states:
    \begin{align}
        v_\alpha(t+\Delta t) &= v_\alpha(t) +a_{\rm mic}(s_\alpha(t), v_\alpha (t), v_l (t))\Delta t,\\
        x_\alpha(t + \Delta t) &= x_\alpha(t) + \frac{v_\alpha (t) + v_\alpha (t+\Delta t)}{2}\Delta t,
    \end{align}
    where $\delta t$ is the time step and $a_{\rm mic}$ is the acceleration function defined by the car following model used. This acceleration function is described in section(\ref{ch3.1}).

    When solving the equations above numerically, we must also consider the interactions between cars. The velocity equation uses $v_l(t)$, the velocity of the leading car at time $t$. So, when calculating the state of a car at each timestep, it would be easier to start from the backmost car and work up. This allows us to use the most recent velocity value from the leading car.     

    \section{Car Following Model}
    \subsection{Full Velocity Difference Model}\label{ch3.1}
    We followed the details of the Full Velocity Difference Model in \S 10.6 and \S 10.7 of [\cite{traffic}]. The Full Velocity Difference Model (FVDM) is given by the acceleration function: 
    \begin{equation} 
      a_{\rm mic}(s_\alpha,v_\alpha,v_l) = \frac{v_{\rm opt} (s) - v_\alpha}{\tau} - \gamma \Delta v 
    \end{equation}
    where $v_{\rm opt}$ is the optimal velocity function, $\tau$ is the speed adaptation time, $\gamma$ is the speed difference sensitivity, and $\Delta v = v_\alpha - v_l$ is the difference between in velocities of the car $\alpha$ and the leader car.
    
    A simple choice for $v_{\rm opt}$ is 
    \begin{equation} 
      v_{\rm opt} (s) = \max \left( 0, \min \left( v_0, \frac{s-s_0}{T} \right) \right)
    \end{equation}
    where $v_0$ is the desired speed, $s_0$ is the minimum distance gap, and $T$ is the time gap. 

    Typical parameters for highway traffic for the FVDM is given in the table below. 
    \begin{figure}[H]
      \begin{center}
        \begin{tabular}{ c c } 
        Parameter & Value \\
        \hline
        $v_0$ & yes \\
        \end{tabular}
        \end{center}
    \end{figure}
    TODO: Include a graph of $v_{\rm opt}$, include typical parameters, look at the pitfalls (since gap is used, stuff from far away can affect it and unrealistic acceleration which can be included in section 4.1 maybe?), explanation of the parameters and what they mean 
    \section{Examining Different Scenarios}
    \subsection{Homogeneous Traffic}
    TODO: Give basic graphs so that we can compare to in the next sections and add any pitfalls with the model (unrealistic acceleration) 
    \subsubsection{Simulation}
    \subsubsection{Pitfalls}
    \subsection{Bottleneck}
    TODO: Add time versus position graph and label the different situations, density graph, analysis 
    \subsubsection{Implementation}
    \subsubsection{Simulation}
    \subsubsection{Analysis}
    \subsection{Phantom Traffic: Local Perturbation}
    \subsubsection{Implementation}
    TODO: Look at how stopping suddenly propagate through the cars. Something about waves? 
    \subsection{Lane Changes}
    TODO: Average lane speed (How much faster is one lane with and without lane changes) and bottleneck revisted (make it from 2 lanes to one lane) and how number of lanes affect flow rate. The grass is greener on the other side paradox (in the textbook) 
    \subsubsection{Implementation}
    \subsection{Multi-lanes Bottleneck}
    \subsubsection{Implementation}
    \subsubsection{Simulation}
    \subsubsection{Analysis}
    \section{Conclusion}
    \section{Further Remarks}
    \printunsrtglossary[type=symbols,style=long,title={List of Symbols and Constants}]
    \newpage 
    \printbibliography
\end{document}